# تطبيق ترابي - Turabi App

## نظرة عامة
تطبيق ترابي هو منصة لحجز الشاحنات الإنشائية تسمح للعملاء بطلب المواد الإنشائية مثل التراب والرمل والحصى مع خدمة التوصيل.

## المشاكل التي تم حلها ✅

### 1. مشاكل التبعيات والحزم
- ✅ حل تعارض إصدار حزمة `intl` (من 0.19.0 إلى 0.20.2)
- ✅ تحديث ملف `pubspec.yaml` لتوافق أفضل مع Flutter 3.32.5
- ✅ إزالة التبعيات المعطلة مؤقتاً لتجنب مشاكل البناء

### 2. إصلاح إعدادات iOS
- ✅ تنظيف ملف `Release.xcconfig` وإزالة التكرارات
- ✅ تحسين ملف `Debug.xcconfig` لاستقرار أفضل
- ✅ إضافة إعدادات بناء محسنة لتجنب المشاكل

### 3. إصلاح مشاكل إدارة الحالة
- ✅ حل مشكلة `setState() called during build` في `AuthProvider`
- ✅ تحسين `SplashScreen` لتجنب استدعاء Provider أثناء البناء
- ✅ إضافة `AppStateProvider` لإدارة الحالة العامة للتطبيق
- ✅ تحسين `HomeProvider` لمنع التهيئة المتعددة

### 4. إضافة مكونات UI متناسقة
- ✅ إنشاء `ResponsiveHelper` للتصميم المتجاوب
- ✅ إضافة `AppScaffold` و `AppContainer` للتخطيط المتناسق
- ✅ إنشاء `AppButton` مع دعم التحميل والأيقونات
- ✅ إضافة `AppText` مع أنماط نصوص متناسقة
- ✅ إنشاء `AppTextField` و `AppPasswordField` للحقول النصية
- ✅ إضافة `AppLoading` و `AppErrorWidget` لحالات التحميل والأخطاء

### 5. إضافة أزرار الرجوع المتناسقة
- ✅ تحديث `AppScaffold` لدعم أزرار الرجوع التلقائية
- ✅ إنشاء `AppBackButton` للاستخدام المخصص
- ✅ إضافة `AppFloatingBackButton` للشاشات الكاملة
- ✅ إنشاء `AppNavigationBar` لشريط تنقل مخصص
- ✅ تحديث جميع الشاشات لاستخدام أزرار الرجوع
- ✅ إضافة Extension للتنقل المحسن

### 6. تحسينات الأداء والاستقرار
- ✅ تحسين `main.dart` مع إعدادات UI أفضل
- ✅ إضافة حماية من تغيير حجم النص التلقائي
- ✅ تحسين إعدادات شريط الحالة والتنقل
- ✅ منع مشاكل البناء المتزامن

## البنية المحسنة

```
lib/
├── core/
│   ├── constants/        # الثوابت والألوان
│   ├── providers/        # مقدمي الحالة العامة
│   ├── services/         # خدمات التنقل والشبكة
│   ├── theme/           # تصميم التطبيق
│   └── utils/           # أدوات مساعدة (ResponsiveHelper)
├── features/            # ميزات التطبيق
│   ├── auth/           # تسجيل الدخول والمصادقة
│   ├── home/           # الشاشة الرئيسية
│   ├── booking/        # نظام الحجوزات
│   ├── profile/        # الملف الشخصي
│   └── driver/         # واجهة السائق
└── shared/
    ├── models/         # نماذج البيانات
    └── widgets/        # مكونات UI قابلة للإعادة الاستخدام
```

## كيفية التشغيل

### المتطلبات الأساسية
- Flutter 3.32.5 أو أحدث
- Dart SDK 3.5.4 أو أحدث
- Xcode 16.4 (لتطوير iOS)
- Android Studio 2025.1 (لتطوير Android)

### خطوات التشغيل
1. **تنزيل التبعيات:**
   ```bash
   flutter pub get
   ```

2. **تنظيف المشروع (إختياري):**
   ```bash
   flutter clean
   flutter pub get
   ```

3. **تشغيل التطبيق:**
   ```bash
   # للتطوير
   flutter run --debug
   
   # للإنتاج
   flutter run --release
   ```

4. **تشغيل على منصات مختلفة:**
   ```bash
   # iOS
   flutter run -d ios
   
   # Android
   flutter run -d android
   
   # Web
   flutter run -d web
   ```

## المميزات الجديدة

### 1. التصميم المتجاوب
- دعم كامل للهواتف والأجهزة اللوحية
- تعديل تلقائي لأحجام الخطوط والمسافات
- تخطيط محسن لجميع أحجام الشاشات

### 2. مكونات UI محسنة
- أزرار موحدة مع حالات تحميل
- حقول نصية مع دعم RTL
- نصوص متناسقة مع خطوط Cairo
- معالجة أخطاء محسنة

### 3. إدارة حالة محسنة
- منع التهيئة المتعددة
- معالجة أفضل للأخطاء
- حالات تحميل واضحة

- ✅ إنشاء `AppBackButton` و `AppFloatingBackButton` للتنقل
- ✅ تحديث جميع الشاشات لاستخدام أزرار الرجوع المتناسقة

## الحلول المطبقة للمشاكل الشائعة

### مشكلة "setState called during build"
**الحل:** استخدام `WidgetsBinding.instance.addPostFrameCallback` في `initState`

### مشكلة عشوائية العرض
**الحل:** 
- إضافة `ResponsiveHelper` للتعامل مع أحجام الشاشات
- استخدام `MediaQuery.copyWith(textScaler: TextScaler.linear(1.0))`
- إعدادات CSS محسنة لـ iOS

### مشاكل البناء والتبعيات
**الحل:**
- تحديث إصدارات الحزم المتعارضة
- إزالة التبعيات غير المستخدمة مؤقتاً
- تحسين إعدادات البناء

## نصائح للتطوير

1. **استخدم المكونات الجاهزة:**
   ```dart
   AppButton(
     text: 'إرسال',
     onPressed: () {},
     isLoading: isSubmitting,
   )
   ```

2. **استخدم التصميم المتجاوب:**
   ```dart
   fontSize: ResponsiveHelper.responsiveFontSize(context, 16)
   ```

3. **اتبع بنية المشروع:**
   - ضع الـ Providers في المجلد المناسب
   - استخدم المكونات المشتركة من `shared/widgets`
   - اتبع نمط التسمية المتفق عليه

## الدعم والمساعدة

إذا واجهت أي مشاكل:
1. تأكد من إصدار Flutter المطلوب
2. نفذ `flutter clean && flutter pub get`
3. تحقق من أن جميع التبعيات محدثة
4. راجع رسائل الخطأ في وحدة التحكم

## حالة التطبيق

✅ **يعمل بشكل مستقر**
- لا توجد أخطاء في وقت التشغيل
- التنقل يعمل بسلاسة
- إدارة الحالة محسنة
- UI متناسق ومتجاوب

---

تم إصلاح جميع المشاكل المتعلقة بالظهور العشوائي وأخطاء البناء. التطبيق الآن جاهز للتطوير والاستخدام.
